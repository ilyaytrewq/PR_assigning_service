# PR_assigning_service

## Дополнительный функционал

### Эндпоинт статистики

- Добавлен сервисный метод `GetStats` (`internal/service/services.go`) и хендлер `GetStats` (`internal/handlers/handlers.go`), доступный по `GET /stats`.
- Возвращает агрегированную статистику по системе:
	- `total_teams` — общее количество команд;
	- `total_pull_requests`, `open_pull_requests`, `merged_pull_requests` — общее количество PR, количество открытых и замёрженных;
	- `total_users`, `active_users` — общее количество пользователей и число активных.
- Параллельно выполняются четыре независимых запроса (`users`, `teams`, `pull_requests`, назначения по пользователям) через `sync.WaitGroup` и `sync.Mutex`

Запуск:

```bash
docker compose up --build
```

## Нагрузочное тестирование (k6)

Для нагрузочного теста использовался `k6` со скриптом `tests/load_test.js`.

### Сценарий

В рамках одной итерации:

1. `POST /team/add` — создание команды с тремя участниками (2 активных, 1 неактивный).
2. `POST /pullRequest/create` — создание PR от одного из участников команды.
3. `sleep(0.2)` — небольшая пауза.
4. Несколько `GET`‑запросов:
	 - `GET /users/getReview?user_id=...` — список PR, где пользователь назначен ревьювером;
	 - `GET /team/get?team_name=...` — получение команды и списка участников;
	 - `GET /stats` — агрегированная статистика.

Параметры нагрузки:

```js
export const options = {
	stages: [
		{ duration: '20s', target: 10 },
		{ duration: '40s', target: 30 },
		{ duration: '20s', target: 0 },
	],
};
```

- до 30 VU,

### Запуск теста

```bash
docker compose up --build -d
k6 run tests/load_test.js
```

### Результаты (один из прогонов)


- **Среднее время отклика**: 12.44ms
- **Максимальное время отклика**: 146.22ms
- **Количество успешных запросов**: 100%
- **Количество выполненных запросов**: 22,690
- **Количество переданных данных**: 7.0 MB
- **Частота запросов**: 282.97 запросов/сек
